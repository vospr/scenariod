# Implementation: T-002 — Implement GET /health endpoint
**Date:** 2026-02-18

## Changes Made

- `src/routes/health.js` (created): Express Router with a single `GET /health` handler. Returns HTTP 200 with `Content-Type: application/json` and body `{"status":"ok","timestamp":"<ISO8601>"}`. Timestamp is generated via `new Date().toISOString()` which always produces a valid ISO 8601 string.
- `src/app.js` (updated): Added `require('./routes/health')` import and mounted the health router via `app.use(healthRouter)`. The app still exports without calling `listen()`.
- `src/server.js` (created): Reads `process.env.PORT` with fallback to `3000`. Calls `app.listen(PORT, ...)` and logs the active port. This is the only file that binds to a network port.

## Decisions Made During Implementation

- Used `express.Router()` in `health.js` rather than attaching directly to `app`, keeping route logic fully encapsulated and easily removable/testable in isolation.
- Mounted the router with `app.use(healthRouter)` (no prefix) so the route path `/health` declared in the router is the final public path. Avoids double-prefix bugs.
- `server.js` does not export anything — it is a pure entry point, consistent with the app/server split pattern mandated by the ADR.
- `'use strict'` pragma applied to all three files per project coding standards.

## Assertion Evidence

| Assertion | Evidence |
|-----------|---------|
| A1 — GET /health returns HTTP 200 | Smoke test output: `Status code: 200` |
| A2 — Content-Type is application/json | Smoke test output: `Content-Type: application/json; charset=utf-8` |
| A3 — Body contains `"status": "ok"` | Smoke test output: `status field: ok` |
| A4 — Body contains a valid ISO 8601 timestamp | Smoke test output: `timestamp is ISO 8601: true` (round-trip `new Date(ts).toISOString() === ts` passes) |
| A5 — App exported from app.js without calling listen() | `src/app.js` ends with `module.exports = app` — no `app.listen()` call present |
| A6 — server.js uses PORT env var with fallback 3000 | `const PORT = process.env.PORT \|\| 3000;` in `src/server.js`; verified with `PORT=3099` smoke test: server bound to 3099 |
| A7 — Health route encapsulated in src/routes/health.js, mounted in app.js | File created at `src/routes/health.js`; mounted in `src/app.js` via `app.use(healthRouter)` |

## Testing

- Programmatic smoke test: started app on a random port using `app.listen(0)`, made an HTTP GET to `/health`, validated status code (200), Content-Type header, body shape, `status` field value, and ISO 8601 round-trip for `timestamp`. All assertions passed.
- Server.js PORT env var test: started server with `PORT=3099`, `curl http://localhost:3099/health` returned correct JSON. Confirmed.

## Status
COMPLETED
