# Implementation: T-3 — Write Jest + supertest tests for GET /health
**Date:** 2026-02-18

## Changes Made
- `tests/health.test.js`: Created Jest + supertest test suite with 6 test cases covering all spec
  assertions A1–A6. Uses `require('../src/app')` directly (no port binding) per the app/server
  split architectural constraint.

## Decisions Made During Implementation
- Added an A5 test (body shape) and A6 test (timestamp monotonicity) in addition to the four
  required minimum assertions. These provide defense-in-depth without duplicating existing checks.
- ISO 8601 validation uses `new Date(ts).toISOString() === ts` as mandated in spec notes — this
  avoids exact-value comparison and eliminates timestamp-race flakiness.
- Used `setTimeout(5ms)` in A6 to allow system clock to advance between the two requests; the
  check uses `>=` (not `>`) to remain reliable even if the OS clock resolution is coarser than 1ms.
- No `afterAll` / server teardown needed: supertest binds an ephemeral port per-request and
  releases it automatically when `app` is passed directly.

## Testing
- `npm test` executed; exit code 0; all 6 tests PASS in 1.341s.

## Assertion Evidence
- A1: PASS — tests/health.test.js:8  (`expect(res.status).toBe(200)` — HTTP 200 confirmed)
- A2: PASS — tests/health.test.js:14 (`expect(res.headers['content-type']).toMatch(/application\/json/)` — content-type header confirmed)
- A3: PASS — tests/health.test.js:20 (`expect(res.body.status).toBe('ok')` — status field confirmed)
- A4: PASS — tests/health.test.js:26 (`new Date(ts).toISOString() === ts` — ISO 8601 round-trip confirmed)
- A5: PASS — tests/health.test.js:32 (body shape check — exactly two keys: status + timestamp)
- A6: PASS — tests/health.test.js:39 (monotonicity check — second timestamp >= first)

## Status
COMPLETED
